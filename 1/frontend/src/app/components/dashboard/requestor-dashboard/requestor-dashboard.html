<div class="requestor-dashboard">
  <h2>My Document Requests</h2>

  <button
    *ngIf="!showRequestForm"
    (click)="showRequestForm = true"
    class="btn-primary"
  >
    + New Request
  </button>

  <div *ngIf="showRequestForm" class="request-form">
    <h3>Create New Document Request</h3>
    <div class="form-group">
      <label>Document Type: <span class="required">*</span></label>
      <select
        [(ngModel)]="documentType"
        class="form-control"
        required
      >
        <option value="">-- Select Document Type --</option>
        <option value="clearance">Barangay Clearance</option>
        <option value="indigency">Certificate of Indigency</option>
        <option value="residence">Certificate of Residence</option>
        <option value="recognition">Certificate of Recognition</option>
      </select>
    </div>
    <div class="form-group">
      <label>Message (Optional):</label>
      <textarea
        [(ngModel)]="message"
        placeholder="Add any additional information or notes..."
        class="form-control"
        rows="4"
        maxlength="1000"
      ></textarea>
      <small class="char-count">{{ message.length }}/1000 characters</small>
    </div>
    <div class="form-actions">
      <button
        (click)="submitRequest()"
        [disabled]="loading || !documentType"
        class="btn-primary"
      >
        {{ loading ? 'Submitting...' : 'Submit Request' }}
      </button>
      <button (click)="showRequestForm = false" class="btn-secondary">
        Cancel
      </button>
    </div>
  </div>

  <div *ngIf="error" class="error-message">{{ error }}</div>

  <!-- Filter Buttons -->
  <div *ngIf="documentRequests.length > 0" class="filter-buttons">
    <button
      (click)="setFilter('all')"
      [class.active]="selectedFilter === 'all'"
      class="filter-btn"
    >
      All
    </button>
    <button
      (click)="setFilter('pending')"
      [class.active]="selectedFilter === 'pending'"
      class="filter-btn"
    >
      Pending
    </button>
    <button
      (click)="setFilter('approved')"
      [class.active]="selectedFilter === 'approved'"
      class="filter-btn"
    >
      Approved
    </button>
    <button
      (click)="setFilter('rejected')"
      [class.active]="selectedFilter === 'rejected'"
      class="filter-btn"
    >
      Rejected
    </button>
  </div>

  <div *ngIf="loading && !documentRequests.length" class="loading">
    Loading...
  </div>

  <div *ngIf="!loading && documentRequests.length === 0" class="empty-state">
    <p>No document requests yet. Create your first request!</p>
  </div>

  <div *ngIf="!loading && documentRequests.length > 0 && filteredRequests.length === 0" class="empty-state">
    <p>No {{ selectedFilter }} requests found.</p>
  </div>

  <div *ngIf="filteredRequests.length > 0" class="requests-list">
    <div *ngFor="let request of filteredRequests" class="request-card">
      <div class="request-header">
        <h3>{{ request.document_type }}</h3>
        <span
          [class]="'status-badge ' + getStatusClass(request.document_status)"
        >
          {{ request.document_status }}
        </span>
      </div>
      <div class="request-details">
        <p>
          <strong>Requested:</strong> {{ request.created_at | date:'short' }}
        </p>
        <p *ngIf="request.document_status !== 'pending'">
          <strong>Updated:</strong> {{ request.updated_at | date:'short' }}
        </p>
      </div>

      <div *ngIf="request.requestor_message" class="requestor-message">
        <strong>Your Message:</strong> {{ request.requestor_message }}
      </div>

      <div *ngIf="request.staff_message" class="staff-message">
        <strong>Staff Message:</strong> {{ request.staff_message }}
      </div>
    </div>
  </div>
</div>

<style>
  .requestor-dashboard {
    max-width: 800px;
    margin: 0 auto;
    padding-bottom: 4%;
  }

  .requestor-dashboard h2 {
    color: #333;
    margin-top: 0;
    margin-bottom: 1.5rem;

    padding-top: 4%;
  }

  .btn-primary {
    background: #495057;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    cursor: pointer;
    margin-bottom: 1.5rem;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  .btn-primary:hover:not(:disabled) {
    background: #343a40;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .btn-secondary {
    background: #6c757d;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 4px;
    cursor: pointer;
    margin-left: 0.5rem;
  }

  .request-form {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 2rem;
  }

  .form-group {
    margin-bottom: 1rem;
  }

  .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: #333;
    font-weight: 500;
  }

  .form-control {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
    font-family: inherit;
  }

  .form-control:focus {
    outline: none;
    border-color: #495057;
    box-shadow: 0 0 0 3px rgba(73, 80, 87, 0.1);
  }

  select.form-control {
    cursor: pointer;
    background-color: white;
  }

  textarea.form-control {
    resize: vertical;
    min-height: 100px;
  }

  .required {
    color: #dc3545;
  }

  .char-count {
    display: block;
    margin-top: 0.25rem;
    color: #666;
    font-size: 0.875rem;
  }

  .form-actions {
    display: flex;
    gap: 0.5rem;
  }

  .error-message {
    background: #f8d7da;
    color: #721c24;
    padding: 1rem;
    border-radius: 4px;
    margin-bottom: 1rem;
  }

  .filter-buttons {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .filter-btn {
    padding: 0.625rem 1.25rem;
    border: 2px solid #e0e0e0;
    background: white;
    color: #666;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }

  .filter-btn:hover {
    border-color: #495057;
    color: #495057;
    background: #f8f9fa;
    transform: translateY(-1px);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  }

  .filter-btn.active {
    background: #495057;
    color: white;
    border-color: #495057;
    box-shadow: 0 2px 8px rgba(73, 80, 87, 0.2);
  }

  .requests-list {
    display: grid;
    gap: 1rem;
  }

  .request-card {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border: 1px solid #f0f0f0;
  }

  .request-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  }

  .request-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .request-header h3 {
    margin: 0;
    color: #333;
  }

  .status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: capitalize;
  }

  .status-pending {
    background: #fff3cd;
    color: #856404;
  }

  .status-approved {
    background: #d4edda;
    color: #155724;
  }

  .status-rejected {
    background: #f8d7da;
    color: #721c24;
  }

  .request-details {
    color: #666;
    font-size: 0.9rem;
  }

  .empty-state {
    text-align: center;
    padding: 3rem;
    color: #666;
  }

  .loading {
    text-align: center;
    padding: 2rem;
    color: #666;
  }

  .requestor-message {
    margin-top: 1rem;
    padding: 0.75rem;
    background: #e7f3ff;
    border-left: 3px solid #007bff;
    border-radius: 4px;
    color: #495057;
  }

  .requestor-message strong {
    color: #0056b3;
  }

  .staff-message {
    margin-top: 1rem;
    padding: 0.75rem;
    background: #f8f9fa;
    border-left: 3px solid #28a745;
    border-radius: 4px;
    color: #495057;
  }

  .staff-message strong {
    color: #155724;
  }
</style>
